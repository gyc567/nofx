# ç”¨æˆ·åˆ—è¡¨æŸ¥è¯¢API - éƒ¨ç½²æŒ‡å—

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### æ­¥éª¤1: æ¨é€ä»£ç åˆ°ä»“åº“
```bash
# æäº¤æ›´æ”¹
cd /Users/guoyingcheng/dreame/code/nofx
git add .
git commit -m "feat(api): æ·»åŠ ç”¨æˆ·åˆ—è¡¨æŸ¥è¯¢API

- åœ¨config/database.goä¸­æ·»åŠ GetUserså’ŒGetUserCountæ–¹æ³•
- åœ¨api/server.goä¸­æ·»åŠ handleGetUserså¤„ç†å™¨
- æ·»åŠ åˆ†é¡µã€æœç´¢ã€æ’åºåŠŸèƒ½
- ä»…ç®¡ç†å‘˜å¯è®¿é—®ï¼ŒåŒ…å«å®Œæ•´çš„æƒé™æ§åˆ¶

Closes: #user-list-api"

# æ¨é€åˆ°è¿œç¨‹ä»“åº“
git push origin main
```

### æ­¥éª¤2: éªŒè¯éƒ¨ç½²
Replitä¼šè‡ªåŠ¨æ£€æµ‹åˆ°ä»£ç å˜æ›´å¹¶é‡æ–°éƒ¨ç½²ã€‚éƒ¨ç½²å®Œæˆåï¼š

```bash
# æµ‹è¯•APIæ˜¯å¦å¯ç”¨
curl https://nofx-gyc567.replit.app/api/users
# æœŸæœ›: {"success": false, "error": "æœªè®¤è¯çš„è®¿é—®"} (è¯´æ˜APIå·²éƒ¨ç½²)
```

### æ­¥éª¤3: è¿è¡Œé›†æˆæµ‹è¯•
```bash
cd /Users/guoyingcheng/dreame/code/nofx/web
chmod +x test_user_list_api.sh
./test_user_list_api.sh
```

## ğŸ“‹ å®Œæ•´éƒ¨ç½²æ£€æŸ¥æ¸…å•

### éƒ¨ç½²å‰æ£€æŸ¥
- [ ] ä»£ç å·²æäº¤åˆ°Gitä»“åº“
- [ ] æœ¬åœ°ç¼–è¯‘é€šè¿‡: `go build -o nofx-backend .`
- [ ] æ•°æ®åº“æ–¹æ³•å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] æµ‹è¯•è„šæœ¬å‡†å¤‡å°±ç»ª

### éƒ¨ç½²ä¸­æ£€æŸ¥
- [ ] Replitæ£€æµ‹åˆ°ä»£ç å˜æ›´
- [ ] è‡ªåŠ¨éƒ¨ç½²å¼€å§‹
- [ ] æ„å»ºæˆåŠŸå®Œæˆ
- [ ] æœåŠ¡é‡å¯æˆåŠŸ
- [ ] APIç«¯ç‚¹å¯è®¿é—®

### éƒ¨ç½²åéªŒè¯
- [ ] APIå¥åº·æ£€æŸ¥: `/api/health`
- [ ] æƒé™æµ‹è¯•: æœªè®¤è¯è¿”å›401
- [ ] åŠŸèƒ½æµ‹è¯•: ç®¡ç†å‘˜ç™»å½•åå¯ä»¥æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨
- [ ] åˆ†é¡µæµ‹è¯•: æµ‹è¯•pageå’Œlimitå‚æ•°
- [ ] æœç´¢æµ‹è¯•: æµ‹è¯•searchå‚æ•°
- [ ] æ’åºæµ‹è¯•: æµ‹è¯•sortå’Œorderå‚æ•°

## ğŸ§ª æµ‹è¯•è„šæœ¬ä½¿ç”¨æŒ‡å—

### å¿«é€Ÿæµ‹è¯•
```bash
# è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
./test_user_list_api.sh
```

### æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤

#### 1. è·å–ç®¡ç†å‘˜token
```bash
TOKEN=$(curl -s -X POST https://nofx-gyc567.replit.app/api/login \
  -H "Content-Type: application/json" \
  -d '{"email":"gyc567@gmail.com","password":"eric8577HH"}' \
  | jq -r '.token')

echo "Token: $TOKEN"
```

#### 2. æµ‹è¯•åŸºæœ¬æŸ¥è¯¢
```bash
curl -s https://nofx-gyc567.replit.app/api/users \
  -H "Authorization: Bearer $TOKEN" | jq '.'
```

#### 3. æµ‹è¯•åˆ†é¡µ
```bash
curl -s "https://nofx-gyc567.replit.app/api/users?page=1&limit=10" \
  -H "Authorization: Bearer $TOKEN" | jq '.data.pagination'
```

#### 4. æµ‹è¯•æœç´¢
```bash
curl -s "https://nofx-gyc567.replit.app/api/users?search=gmail" \
  -H "Authorization: Bearer $TOKEN" | jq '.data.users | length'
```

#### 5. æµ‹è¯•æ’åº
```bash
curl -s "https://nofx-gyc567.replit.app/api/users?sort=email&order=asc" \
  -H "Authorization: Bearer $TOKEN" | jq '.data.users[0].email'
```

#### 6. æµ‹è¯•æƒé™æ§åˆ¶
```bash
# æœªè®¤è¯ï¼ˆæœŸæœ›401ï¼‰
curl -s https://nofx-gyc567.replit.app/api/users | jq '.'
```

## ğŸ” æ•…éšœæ’é™¤

### é—®é¢˜1: APIè¿”å›404 "API endpoint not found"
**åŸå› **: ä»£ç æœªéƒ¨ç½²æˆ–éƒ¨ç½²å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥Gitä»“åº“æ˜¯å¦åŒ…å«æœ€æ–°ä»£ç 
2. æ£€æŸ¥Replitéƒ¨ç½²æ—¥å¿—
3. é‡æ–°è§¦å‘éƒ¨ç½²

### é—®é¢˜2: APIè¿”å›401 "æœªè®¤è¯çš„è®¿é—®"
**åŸå› **: æœªæä¾›æœ‰æ•ˆçš„è®¤è¯token

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®ä¿ä½¿ç”¨äº†æœ‰æ•ˆçš„ç®¡ç†å‘˜token
2. æ£€æŸ¥tokenæ˜¯å¦è¿‡æœŸ
3. é‡æ–°ç™»å½•è·å–æ–°token

### é—®é¢˜3: APIè¿”å›403 "æƒé™ä¸è¶³"
**åŸå› **: å½“å‰ç”¨æˆ·ä¸æ˜¯ç®¡ç†å‘˜

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®ä¿ä½¿ç”¨çš„æ˜¯ç®¡ç†å‘˜è´¦æˆ·
2. æ£€æŸ¥ç”¨æˆ·æ•°æ®åº“ä¸­ `is_admin` å­—æ®µæ˜¯å¦ä¸º `true`

### é—®é¢˜4: APIè¿”å›500 "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯"
**åŸå› **: æ•°æ®åº“æŸ¥è¯¢å¤±è´¥æˆ–å…¶ä»–æœåŠ¡å™¨é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥åç«¯æ—¥å¿—
2. éªŒè¯æ•°æ®åº“è¿æ¥
3. æ£€æŸ¥ç”¨æˆ·è¡¨ç»“æ„

## ğŸ“Š ç›‘æ§å’Œå‘Šè­¦

### å…³é”®æŒ‡æ ‡
- APIå“åº”æ—¶é—´ï¼ˆç›®æ ‡: < 500msï¼‰
- é”™è¯¯ç‡ï¼ˆç›®æ ‡: < 1%ï¼‰
- è¯·æ±‚é‡ï¼ˆç›‘æ§ç”¨æˆ·å¢é•¿ï¼‰

### æ—¥å¿—åˆ†æ
```bash
# æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨APIè®¿é—®æ—¥å¿—
grep "æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨" nofx.log

# æŸ¥çœ‹ç®¡ç†å‘˜è®¿é—®ç»Ÿè®¡
grep "ç®¡ç†å‘˜.*æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨" nofx.log | wc -l
```

### æ€§èƒ½ç›‘æ§
```bash
# æµ‹è¯•APIå“åº”æ—¶é—´
time curl -s https://nofx-gyc567.replit.app/api/users \
  -H "Authorization: Bearer $TOKEN" > /dev/null
```

## ğŸ”„ å›æ»šè®¡åˆ’

### å¦‚æœéƒ¨ç½²å‡ºç°é—®é¢˜

#### å›æ»šæ­¥éª¤
1. **å›æ»šä»£ç **:
   ```bash
   git revert <commit_hash>
   git push origin main
   ```

2. **éªŒè¯å›æ»š**:
   ```bash
   curl https://nofx-gyc567.replit.app/api/users
   # åº”è¯¥è¿”å›404æˆ–åŸæ¥çš„é”™è¯¯
   ```

#### æ•°æ®å®‰å…¨
- æ•°æ®åº“è¡¨ç»“æ„æœªä¿®æ”¹ï¼Œä»…æ·»åŠ äº†æ–°æ–¹æ³•
- å›æ»šä¸ä¼šå½±å“ç°æœ‰æ•°æ®
- å¯ä»¥å®‰å…¨å›æ»šåˆ°éƒ¨ç½²å‰ç‰ˆæœ¬

## ğŸ“ˆ æˆåŠŸæ ‡å‡†

### åŠŸèƒ½æ ‡å‡†
- [ ] APIè¿”å›æ­£ç¡®æ ¼å¼çš„ç”¨æˆ·åˆ—è¡¨
- [ ] åˆ†é¡µåŠŸèƒ½å·¥ä½œæ­£å¸¸
- [ ] æœç´¢åŠŸèƒ½å·¥ä½œæ­£å¸¸
- [ ] æ’åºåŠŸèƒ½å·¥ä½œæ­£å¸¸
- [ ] æƒé™æ§åˆ¶æœ‰æ•ˆ

### æ€§èƒ½æ ‡å‡†
- [ ] APIå“åº”æ—¶é—´ < 500ms
- [ ] æ”¯æŒ100æ¡è®°å½•æŸ¥è¯¢
- [ ] å¹¶å‘æŸ¥è¯¢ç¨³å®š

### å®‰å…¨æ ‡å‡†
- [ ] æœªè®¤è¯è®¿é—®è¿”å›401
- [ ] æ™®é€šç”¨æˆ·è®¿é—®è¿”å›403
- [ ] æ•æ„Ÿä¿¡æ¯å·²è¿‡æ»¤
- [ ] SQLæ³¨å…¥é˜²æŠ¤æœ‰æ•ˆ

## ğŸ“ æ”¯æŒè”ç³»

å¦‚æœåœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·:

1. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„æ•…éšœæ’é™¤éƒ¨åˆ†
2. æ£€æŸ¥GitHub Issues
3. è”ç³»å¼€å‘å›¢é˜Ÿ

---

**éƒ¨ç½²æ—¥æœŸ**: å¾…å¡«å…¥
**éƒ¨ç½²è´Ÿè´£äºº**: å¾…å¡«å…¥
**éªŒè¯è´Ÿè´£äºº**: å¾…å¡«å…¥
