# ç”¨æˆ·åˆ—è¡¨æŸ¥è¯¢API - å®æ–½ä»»åŠ¡æ¸…å•

## ğŸ“‹ æ€»ä½“ä»»åŠ¡

**é¡¹ç›®**: æ·»åŠ ç”¨æˆ·åˆ—è¡¨æŸ¥è¯¢API
**ä¼˜å…ˆçº§**: P1
**é¢„è®¡å®Œæˆæ—¶é—´**: 1å¤©
**å®é™…å¼€å§‹æ—¶é—´**: _______
**å®é™…å®Œæˆæ—¶é—´**: _______

## ğŸ¯ ç¬¬ä¸€é˜¶æ®µï¼šæ•°æ®åº“å±‚å®ç°

### ä»»åŠ¡1.1: æ·»åŠ  `GetUsers` æ–¹æ³•
**é¢„ä¼°æ—¶é—´**: 0.25å¤©
**æ–‡ä»¶**: `/config/database.go`

**å®ç°æ­¥éª¤**:
```go
// GetUsers è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆåˆ†é¡µã€æœç´¢ã€æ’åºï¼‰
// @param page é¡µç ï¼ˆä»1å¼€å§‹ï¼‰
// @param limit æ¯é¡µæ•°é‡
// @param search æœç´¢å…³é”®è¯ï¼ˆå¯é€‰ï¼‰
// @param sort æ’åºå­—æ®µ
// @param order æ’åºæ–¹å‘ï¼ˆasc/descï¼‰
// @return users ç”¨æˆ·åˆ—è¡¨
// @return total æ€»è®°å½•æ•°
// @return error é”™è¯¯ä¿¡æ¯
func (d *Database) GetUsers(page, limit int, search, sort, order string) ([]*User, int, error) {
    // TODO: å®ç°æ•°æ®åº“æŸ¥è¯¢é€»è¾‘
}
```

**æ£€æŸ¥æ¸…å•**:
- [ ] SQLæŸ¥è¯¢è¯­å¥æ­£ç¡®ï¼ˆä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥é˜²æ³¨å…¥ï¼‰
- [ ] åˆ†é¡µé€»è¾‘æ­£ç¡®ï¼ˆLIMITå’ŒOFFSETï¼‰
- [ ] æœç´¢åŠŸèƒ½æ­£å¸¸ï¼ˆé‚®ç®±æ¨¡ç³ŠåŒ¹é…ï¼‰
- [ ] æ’åºåŠŸèƒ½æ­£å¸¸ï¼ˆcreated_at, emailï¼‰
- [ ] å‚æ•°éªŒè¯ï¼ˆlimitæœ€å¤§å€¼100ï¼‰
- [ ] æ•æ„Ÿä¿¡æ¯è¿‡æ»¤ï¼ˆä¸è¿”å›å¯†ç ã€OTPç­‰ï¼‰

### ä»»åŠ¡1.2: æ·»åŠ  `GetUserCount` æ–¹æ³•
**é¢„ä¼°æ—¶é—´**: 0.15å¤©
**æ–‡ä»¶**: `/config/database.go`

**å®ç°æ­¥éª¤**:
```go
// GetUserCount è·å–ç”¨æˆ·æ€»æ•°
// @param search æœç´¢å…³é”®è¯ï¼ˆå¯é€‰ï¼‰
// @return count æ€»è®°å½•æ•°
// @return error é”™è¯¯ä¿¡æ¯
func (d *Database) GetUserCount(search string) (int, error) {
    // TODO: å®ç°è®¡æ•°æŸ¥è¯¢é€»è¾‘
}
```

**æ£€æŸ¥æ¸…å•**:
- [ ] COUNTæŸ¥è¯¢æ­£ç¡®
- [ ] æœç´¢è¿‡æ»¤é€»è¾‘ä¸€è‡´
- [ ] è¿”å›ç±»å‹æ­£ç¡®

### ä»»åŠ¡1.3: å•å…ƒæµ‹è¯•
**é¢„ä¼°æ—¶é—´**: 0.1å¤©
**æ–‡ä»¶**: `/config/database_test.go`

**æµ‹è¯•ç”¨ä¾‹**:
- [ ] æµ‹è¯•æ­£å¸¸è·å–ç”¨æˆ·åˆ—è¡¨
- [ ] æµ‹è¯•åˆ†é¡µåŠŸèƒ½
- [ ] æµ‹è¯•æœç´¢åŠŸèƒ½
- [ ] æµ‹è¯•æ’åºåŠŸèƒ½
- [ ] æµ‹è¯•è¾¹ç•Œæƒ…å†µï¼ˆpage=0, limit=100+ï¼‰
- [ ] æµ‹è¯•GetUserCountæ–¹æ³•

## ğŸ¯ ç¬¬äºŒé˜¶æ®µï¼šAPIå±‚å®ç°

### ä»»åŠ¡2.1: æ·»åŠ APIè·¯ç”±
**é¢„ä¼°æ—¶é—´**: 0.1å¤©
**æ–‡ä»¶**: `/api/server.go`

**å®ç°ä½ç½®**:
åœ¨ç°æœ‰çš„å—ä¿æŠ¤è·¯ç”±ç»„ä¸­æ·»åŠ ï¼š
```go
protected := api.Group("/", s.authMiddleware())
{
    // ... ç°æœ‰è·¯ç”± ...

    // ç”¨æˆ·åˆ—è¡¨ï¼ˆä»…ç®¡ç†å‘˜ï¼‰
    protected.GET("/users", s.handleGetUsers)
}
```

**æ£€æŸ¥æ¸…å•**:
- [ ] è·¯ç”±è·¯å¾„æ­£ç¡®ï¼š`/users`
- [ ] ä½¿ç”¨æ­£ç¡®çš„ä¸­é—´ä»¶ï¼š`s.authMiddleware()`
- [ ] ä¸éœ€è¦é¢å¤–çš„æƒé™æ£€æŸ¥ï¼ˆåœ¨å¤„ç†å™¨ä¸­å¤„ç†ï¼‰

### ä»»åŠ¡2.2: å®ç° `handleGetUsers` å¤„ç†å™¨
**é¢„ä¼°æ—¶é—´**: 0.3å¤©
**æ–‡ä»¶**: `/api/server.go`

**å®ç°æ­¥éª¤**:
```go
// handleGetUsers å¤„ç†è·å–ç”¨æˆ·åˆ—è¡¨è¯·æ±‚
func (s *Server) handleGetUsers(c *gin.Context) {
    // 1. å‚æ•°è§£æå’ŒéªŒè¯
    page := parseInt(c.Query("page"), 1)
    limit := parseInt(c.Query("limit"), 50)
    search := c.Query("search")
    sort := parseString(c.Query("sort"), "created_at")
    order := parseString(c.Query("order"), "desc")

    // 2. æƒé™æ£€æŸ¥ï¼ˆå¿…é¡»æ˜¯ç®¡ç†å‘˜ï¼‰
    user := c.MustGet("user").(*User)
    if !user.IsAdmin {
        c.JSON(http.StatusForbidden, gin.H{
            "success": false,
            "error":   "æƒé™ä¸è¶³ï¼Œéœ€è¦ç®¡ç†å‘˜æƒé™",
        })
        return
    }

    // 3. è°ƒç”¨æ•°æ®åº“æ–¹æ³•
    users, total, err := s.database.GetUsers(page, limit, search, sort, order)
    if err != nil {
        log.Printf("è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥: %v", err)
        c.JSON(http.StatusInternalServerError, gin.H{
            "success": false,
            "error":   "è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥",
        })
        return
    }

    // 4. æ„å»ºå“åº”
    response := buildUserListResponse(users, total, page, limit)

    // 5. è®°å½•è®¿é—®æ—¥å¿—
    log.Printf("ç®¡ç†å‘˜ %s æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨ (page=%d, limit=%d, search=%s)",
        user.Email, page, limit, search)

    // 6. è¿”å›å“åº”
    c.JSON(http.StatusOK, gin.H{
        "success": true,
        "data":    response,
        "message": "è·å–ç”¨æˆ·åˆ—è¡¨æˆåŠŸ",
    })
}
```

**æ£€æŸ¥æ¸…å•**:
- [ ] å‚æ•°è§£ææ­£ç¡®
- [ ] ç®¡ç†å‘˜æƒé™éªŒè¯
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] å“åº”æ ¼å¼æ­£ç¡®
- [ ] è®¿é—®æ—¥å¿—è®°å½•

### ä»»åŠ¡2.3: æ·»åŠ è¾…åŠ©å‡½æ•°
**é¢„ä¼°æ—¶é—´**: 0.1å¤©

**å‡½æ•°1**: å‚æ•°è§£æ
```go
func parseInt(value string, defaultValue int) int {
    if value == "" {
        return defaultValue
    }
    if intVal, err := strconv.Atoi(value); err == nil {
        return intVal
    }
    return defaultValue
}

func parseString(value, defaultValue string) string {
    if value == "" {
        return defaultValue
    }
    return value
}
```

**æ£€æŸ¥æ¸…å•**:
- [ ] å‚æ•°è§£æå‡½æ•°æ­£ç¡®
- [ ] é»˜è®¤å€¼è®¾ç½®æ­£ç¡®
- [ ] é”™è¯¯å¤„ç†æ­£ç¡®

## ğŸ¯ ç¬¬ä¸‰é˜¶æ®µï¼šæµ‹è¯•éªŒè¯

### ä»»åŠ¡3.1: é›†æˆæµ‹è¯•
**é¢„ä¼°æ—¶é—´**: 0.15å¤©

**æµ‹è¯•åœºæ™¯**:
```bash
# æµ‹è¯•1: æ­£å¸¸è®¿é—®ï¼ˆéœ€è¦ç®¡ç†å‘˜tokenï¼‰
curl -X GET "https://nofx-gyc567.replit.app/api/users" \
  -H "Authorization: Bearer <admin_token>"

# æœŸæœ›: 200 OKï¼Œè¿”å›ç”¨æˆ·åˆ—è¡¨

# æµ‹è¯•2: æœªè®¤è¯è®¿é—®
curl -X GET "https://nofx-gyc567.replit.app/api/users"

# æœŸæœ›: 401 Unauthorized

# æµ‹è¯•3: æ™®é€šç”¨æˆ·è®¿é—®
curl -X GET "https://nofx-gyc567.replit.app/api/users" \
  -H "Authorization: Bearer <user_token>"

# æœŸæœ›: 403 Forbidden

# æµ‹è¯•4: åˆ†é¡µæŸ¥è¯¢
curl -X GET "https://nofx-gyc567.replit.app/api/users?page=1&limit=10" \
  -H "Authorization: Bearer <admin_token>"

# æœŸæœ›: 200 OKï¼Œè¿”å›ç¬¬ä¸€é¡µï¼Œæ¯é¡µ10æ¡

# æµ‹è¯•5: æœç´¢æŸ¥è¯¢
curl -X GET "https://nofx-gyc567.replit.app/api/users?search=gmail" \
  -H "Authorization: Bearer <admin_token>"

# æœŸæœ›: 200 OKï¼Œè¿”å›åŒ…å«"gmail"çš„ç”¨æˆ·
```

**æ£€æŸ¥æ¸…å•**:
- [ ] æ‰€æœ‰æµ‹è¯•åœºæ™¯é€šè¿‡
- [ ] æƒé™æ§åˆ¶æ­£ç¡®
- [ ] å“åº”æ ¼å¼æ­£ç¡®
- [ ] é”™è¯¯å¤„ç†æ­£ç¡®

### ä»»åŠ¡3.2: æ€§èƒ½æµ‹è¯•
**é¢„ä¼°æ—¶é—´**: 0.1å¤©

**æµ‹è¯•å†…å®¹**:
- [ ] å¤§é‡æ•°æ®æŸ¥è¯¢æ€§èƒ½ï¼ˆ>1000ç”¨æˆ·ï¼‰
- [ ] åˆ†é¡µæŸ¥è¯¢é€Ÿåº¦
- [ ] æœç´¢åŠŸèƒ½æ€§èƒ½
- [ ] å¹¶å‘æŸ¥è¯¢æµ‹è¯•ï¼ˆå¤šä¸ªç®¡ç†å‘˜åŒæ—¶æŸ¥è¯¢ï¼‰

## ğŸ¯ ç¬¬å››é˜¶æ®µï¼šæ–‡æ¡£å’Œéƒ¨ç½²

### ä»»åŠ¡4.1: æ›´æ–°APIæ–‡æ¡£
**é¢„ä¼°æ—¶é—´**: 0.1å¤©
**æ–‡ä»¶**: `/API_DOCUMENTATION.md`

**æ›´æ–°å†…å®¹**:
- [ ] æ·»åŠ ç”¨æˆ·åˆ—è¡¨APIç« èŠ‚
- [ ] æ·»åŠ è¯·æ±‚ç¤ºä¾‹
- [ ] æ·»åŠ å“åº”ç¤ºä¾‹
- [ ] æ›´æ–°APIç«¯ç‚¹ç´¢å¼•

### ä»»åŠ¡4.2: éƒ¨ç½²éªŒè¯
**é¢„ä¼°æ—¶é—´**: 0.1å¤©

**æ£€æŸ¥æ¸…å•**:
- [ ] ä»£ç éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
- [ ] éªŒè¯APIè®¿é—®æ­£å¸¸
- [ ] éªŒè¯æƒé™æ§åˆ¶æ­£ç¡®
- [ ] ç›‘æ§æŒ‡æ ‡æ­£å¸¸

## ğŸ“ ä»£ç æäº¤æŒ‡å—

### æäº¤ä¿¡æ¯æ ¼å¼
```
feat(api): æ·»åŠ ç”¨æˆ·åˆ—è¡¨æŸ¥è¯¢API

- åœ¨config/database.goä¸­æ·»åŠ GetUserså’ŒGetUserCountæ–¹æ³•
- åœ¨api/server.goä¸­æ·»åŠ handleGetUserså¤„ç†å™¨
- æ·»åŠ åˆ†é¡µã€æœç´¢ã€æ’åºåŠŸèƒ½
- ä»…ç®¡ç†å‘˜å¯è®¿é—®ï¼ŒåŒ…å«å®Œæ•´çš„æƒé™æ§åˆ¶

Closes: #123
```

### åˆ†æ”¯ç­–ç•¥
1. ä» `main` åˆ†æ”¯åˆ›å»ºæ–°åˆ†æ”¯: `feature/add-user-list-api`
2. å®Œæˆå¼€å‘ååˆ›å»ºPull Request
3. ä»£ç å®¡æŸ¥é€šè¿‡ååˆå¹¶åˆ° `main`

## ğŸ“‹ éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶
- [ ] APIè¿”å›ç”¨æˆ·åˆ—è¡¨æ­£ç¡®
- [ ] åˆ†é¡µåŠŸèƒ½æ­£å¸¸
- [ ] æœç´¢åŠŸèƒ½æ­£å¸¸
- [ ] æ’åºåŠŸèƒ½æ­£å¸¸
- [ ] æƒé™æ§åˆ¶æ­£ç¡®

### æ€§èƒ½éªŒæ”¶
- [ ] å“åº”æ—¶é—´ < 500msï¼ˆæ­£å¸¸è´Ÿè½½ï¼‰
- [ ] æ”¯æŒæœ€å¤§100æ¡è®°å½•æŸ¥è¯¢
- [ ] å¹¶å‘æŸ¥è¯¢ç¨³å®š

### å®‰å…¨éªŒæ”¶
- [ ] ä»…ç®¡ç†å‘˜å¯è®¿é—®
- [ ] æ•æ„Ÿä¿¡æ¯å·²è¿‡æ»¤
- [ ] SQLæ³¨å…¥é˜²æŠ¤
- [ ] è®¿é—®æ—¥å¿—è®°å½•

### å…¼å®¹æ€§éªŒæ”¶
- [ ] ä¸å½±å“ç°æœ‰API
- [ ] å‘åå…¼å®¹
- [ ] æ•°æ®åº“ç»“æ„æ— å˜æ›´

## ğŸš¨ æ½œåœ¨é£é™©å’Œåº”å¯¹

### é£é™©1: æ€§èƒ½é—®é¢˜
- **åŸå› **: ç”¨æˆ·æ•°é‡åºå¤§æ—¶æŸ¥è¯¢æ…¢
- **åº”å¯¹**: æ·»åŠ æ•°æ®åº“ç´¢å¼•ï¼Œä½¿ç”¨åˆ†é¡µ

### é£é™©2: æƒé™ç»•è¿‡
- **åŸå› **: æƒé™æ£€æŸ¥ä¸å½“
- **åº”å¯¹**: ä¸¥æ ¼çš„æƒé™éªŒè¯ï¼Œä»£ç å®¡æŸ¥

### é£é™©3: æ•°æ®æ³„éœ²
- **åŸå› **: æ•æ„Ÿä¿¡æ¯æœªè¿‡æ»¤
- **åº”å¯¹**: åªè¿”å›å¿…è¦å­—æ®µï¼Œä»£ç å®¡æŸ¥

## ğŸ“Š é¡¹ç›®è·Ÿè¸ª

### è¿›åº¦è·Ÿè¸ª
| ä»»åŠ¡ | è´Ÿè´£äºº | å¼€å§‹æ—¶é—´ | é¢„è®¡å®Œæˆæ—¶é—´ | å®é™…å®Œæˆæ—¶é—´ | çŠ¶æ€ |
|------|--------|----------|--------------|--------------|------|
| æ•°æ®åº“æ–¹æ³•å®ç° | ___ | _______ | _______ | _______ | ___ |
| APIå®ç° | ___ | _______ | _______ | _______ | ___ |
| æµ‹è¯•éªŒè¯ | ___ | _______ | _______ | _______ | ___ |
| æ–‡æ¡£æ›´æ–° | ___ | _______ | _______ | _______ | ___ |
| éƒ¨ç½²éªŒè¯ | ___ | _______ | _______ | _______ | ___ |

### é—®é¢˜è·Ÿè¸ª
| é—®é¢˜ | ä¼˜å…ˆçº§ | çŠ¶æ€ | è§£å†³æ–¹æ¡ˆ | è´Ÿè´£äºº |
|------|--------|------|----------|--------|
| ___ | ___ | ___ | ___ | ___ |

## âœ… å®Œæˆç¡®è®¤

**ä»£ç å®¡æŸ¥**: â–¡ é€šè¿‡ â–¡ å¤±è´¥
**æµ‹è¯•éªŒè¯**: â–¡ é€šè¿‡ â–¡ å¤±è´¥
**æ–‡æ¡£æ›´æ–°**: â–¡ å®Œæˆ â–¡ æœªå®Œæˆ
**éƒ¨ç½²éªŒè¯**: â–¡ é€šè¿‡ â–¡ å¤±è´¥

**æœ€ç»ˆç¡®è®¤äºº**: _______________
**ç¡®è®¤æ—¥æœŸ**: _______________

---

**å¤‡æ³¨**:
- æœ¬æ–‡æ¡£åº”ä¸APIè§„èŒƒå’ŒåŠŸèƒ½ææ¡ˆä¸€èµ·é˜…è¯»
- å®æ–½è¿‡ç¨‹ä¸­å¦‚é‡é—®é¢˜ï¼ŒåŠæ—¶æ›´æ–°æœ¬æ–‡æ¡£
- å®Œæˆæ‰€æœ‰ä»»åŠ¡åï¼Œå°†æœ¬æ–‡æ¡£æ ‡è®°ä¸ºå·²å®Œæˆ
