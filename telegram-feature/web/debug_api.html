<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Debug Test</title>
    <style>
        body {
            background: #0B0E11;
            color: #EAECEF;
            font-family: monospace;
            padding: 20px;
        }
        .card {
            background: #1E2329;
            border: 1px solid #2B3139;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .success { color: #0ECB81; }
        .error { color: #F6465D; }
        .warning { color: #F0B90B; }
        pre {
            background: #0B0E11;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        button {
            background: #F0B90B;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
        }
        button:hover {
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <h1>ğŸ” API è°ƒç”¨æµ‹è¯•</h1>

    <div class="card">
        <h2>1. æµ‹è¯•ç«èµ›æ•°æ®æ¥å£</h2>
        <button onclick="testCompetition()">è°ƒç”¨ /api/competition</button>
        <div id="competition-result"></div>
    </div>

    <div class="card">
        <h2>2. æµ‹è¯•TopTraderè´¦æˆ·æ¥å£</h2>
        <button onclick="testAccount()">è°ƒç”¨ /api/account</button>
        <div id="account-result"></div>
    </div>

    <div class="card">
        <h2>3. æµ‹è¯•TopTraderåˆ—è¡¨æ¥å£</h2>
        <button onclick="testTopTraders()">è°ƒç”¨ /api/top-traders</button>
        <div id="toptraders-result"></div>
    </div>

    <script>
        const API_BASE = 'https://nofx-gyc567.replit.app/api';

        async function testCompetition() {
            const resultDiv = document.getElementById('competition-result');
            resultDiv.innerHTML = '<span class="warning">â³ æµ‹è¯•ä¸­...</span>';

            try {
                console.log('ğŸš€ è°ƒç”¨ç«èµ›æ¥å£...');
                const response = await fetch(`${API_BASE}/competition`);
                console.log('ğŸ“¡ å“åº”çŠ¶æ€:', response.status, response.statusText);

                const data = await response.json();
                console.log('âœ… å“åº”æ•°æ®:', data);

                if (data && data.traders && data.traders.length > 0) {
                    const trader = data.traders[0];
                    resultDiv.innerHTML = `
                        <span class="success">âœ… æˆåŠŸè·å–æ•°æ®</span><br><br>
                        <strong>Trader: ${trader.trader_name}</strong><br>
                        <strong class="success">æ€»å‡€å€¼: ${trader.total_equity} USDT</strong><br>
                        <strong>æ€»ç›ˆäº: ${trader.total_pnl} (${trader.total_pnl_pct}%)</strong><br>
                        <strong>æŒä»“æ•°: ${trader.position_count}</strong><br><br>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `<span class="error">âŒ æ²¡æœ‰æ‰¾åˆ°äº¤æ˜“å‘˜æ•°æ®</span>`;
                }
            } catch (error) {
                console.error('âŒ é”™è¯¯:', error);
                resultDiv.innerHTML = `<span class="error">âŒ è°ƒç”¨å¤±è´¥: ${error.message}</span>`;
            }
        }

        async function testAccount() {
            const resultDiv = document.getElementById('account-result');
            resultDiv.innerHTML = '<span class="warning">â³ æµ‹è¯•ä¸­...</span>';

            try {
                console.log('ğŸš€ è°ƒç”¨è´¦æˆ·æ¥å£...');
                const response = await fetch(`${API_BASE}/account?trader_id=okx_admin_deepseek_1763601659`);
                console.log('ğŸ“¡ å“åº”çŠ¶æ€:', response.status, response.statusText);

                const data = await response.json();
                console.log('âœ… å“åº”æ•°æ®:', data);

                resultDiv.innerHTML = `
                    <span class="success">âœ… æˆåŠŸè·å–æ•°æ®</span><br><br>
                    <strong class="success">æ€»å‡€å€¼: ${data.total_equity} USDT</strong><br>
                    <strong>å¯ç”¨ä½™é¢: ${data.available_balance} USDT</strong><br>
                    <strong>æ€»ç›ˆäº: ${data.total_pnl} USDT (${data.total_pnl_pct}%)</strong><br>
                    <strong>æŒä»“æ•°: ${data.position_count}</strong><br><br>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (error) {
                console.error('âŒ é”™è¯¯:', error);
                resultDiv.innerHTML = `<span class="error">âŒ è°ƒç”¨å¤±è´¥: ${error.message}</span>`;
            }
        }

        async function testTopTraders() {
            const resultDiv = document.getElementById('toptraders-result');
            resultDiv.innerHTML = '<span class="warning">â³ æµ‹è¯•ä¸­...</span>';

            try {
                console.log('ğŸš€ è°ƒç”¨TopTraderæ¥å£...');
                const response = await fetch(`${API_BASE}/top-traders`);
                console.log('ğŸ“¡ å“åº”çŠ¶æ€:', response.status, response.statusText);

                const data = await response.json();
                console.log('âœ… å“åº”æ•°æ®:', data);

                if (data && data.traders && data.traders.length > 0) {
                    const trader = data.traders[0];
                    resultDiv.innerHTML = `
                        <span class="success">âœ… æˆåŠŸè·å–æ•°æ®</span><br><br>
                        <strong>Trader: ${trader.trader_name}</strong><br>
                        <strong class="success">æ€»å‡€å€¼: ${trader.total_equity} USDT</strong><br>
                        <strong>æ€»ç›ˆäº: ${trader.total_pnl} (${trader.total_pnl_pct}%)</strong><br>
                        <strong>æŒä»“æ•°: ${trader.position_count}</strong><br><br>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `<span class="error">âŒ æ²¡æœ‰æ‰¾åˆ°äº¤æ˜“å‘˜æ•°æ®</span>`;
                }
            } catch (error) {
                console.error('âŒ é”™è¯¯:', error);
                resultDiv.innerHTML = `<span class="error">âŒ è°ƒç”¨å¤±è´¥: ${error.message}</span>`;
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æµ‹è¯•
        window.addEventListener('load', () => {
            console.log('ğŸ”§ é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹æµ‹è¯•...');
            testCompetition();
        });
    </script>
</body>
</html>
