# äº¤æ˜“æ‰€åˆ—è¡¨API 500é”™è¯¯ä¿®å¤å®æ–½æŠ¥å‘Š

## ğŸ“‹ ä¿®å¤æ¦‚è¿°

### é—®é¢˜
å‰ç«¯è°ƒç”¨ `GET /api/supported-exchanges` è¿”å›500é”™è¯¯ï¼Œå¯¼è‡´ç”¨æˆ·æ— æ³•çœ‹åˆ°å¯é…ç½®çš„äº¤æ˜“æ‰€ï¼Œæ— æ³•åˆ›å»ºAIäº¤æ˜“å‘˜ã€‚

### æ ¹æœ¬åŸå› 
1. **æ•°æ®åº“å¤–é”®çº¦æŸé—®é¢˜**: exchangesè¡¨æœ‰å¤–é”®çº¦æŸ `FOREIGN KEY (user_id) REFERENCES users(id)`
2. **ç¼ºå°‘ç³»ç»Ÿç”¨æˆ·**: åˆå§‹åŒ–ä»£ç å°è¯•æ’å…¥ `user_id='default'` çš„äº¤æ˜“æ‰€è®°å½•ï¼Œä½†usersè¡¨ä¸­æ²¡æœ‰id='default'çš„ç”¨æˆ·
3. **å¤åˆä¸»é”®å¤„ç†ä¸å½“**: `ON CONFLICT (id) DO NOTHING` åªæ£€æŸ¥idï¼Œä¸æ£€æŸ¥user_id

### è§£å†³æ–¹æ¡ˆ
å®ç°å®Œæ•´çš„ç³»ç»Ÿç”¨æˆ·ç®¡ç†æœºåˆ¶ï¼Œç¡®ä¿æ•°æ®ä¾èµ–å…³ç³»æ­£ç¡®ï¼š
1. æ·»åŠ  `EnsureDefaultUser()` å‡½æ•°åˆ›å»ºç³»ç»Ÿç”¨æˆ·
2. åœ¨æ•°æ®åˆå§‹åŒ–ä¹‹å‰ç¡®ä¿ç³»ç»Ÿç”¨æˆ·å­˜åœ¨
3. ä¿®å¤ PostgreSQL çš„ `ON CONFLICT` å­å¥ä»¥æ­£ç¡®å¤„ç†å¤åˆä¸»é”®

## ğŸ”§ ä¿®å¤è¯¦æƒ…

### ä¿®æ”¹æ–‡ä»¶
1. `/config/database.go`

### æ ¸å¿ƒå˜æ›´

#### 1. æ·»åŠ EnsureDefaultUserå‡½æ•°

**ä½ç½®**: `config/database.go:842-873`

**æ–°å¢ä»£ç **:
```go
// EnsureDefaultUser ç¡®ä¿defaultç³»ç»Ÿç”¨æˆ·å­˜åœ¨ï¼ˆç”¨äºå­˜å‚¨ç³»ç»Ÿçº§åˆ«é…ç½®ï¼‰
func (d *Database) EnsureDefaultUser() error {
	// æ£€æŸ¥defaultç”¨æˆ·æ˜¯å¦å·²å­˜åœ¨
	var count int
	err := d.queryRow(`SELECT COUNT(*) FROM users WHERE id = 'default'`).Scan(&count)
	if err != nil {
		return err
	}

	// å¦‚æœå·²å­˜åœ¨ï¼Œç›´æ¥è¿”å›
	if count > 0 {
		return nil
	}

	// åˆ›å»ºdefaultç”¨æˆ·ï¼ˆç³»ç»Ÿçº§åˆ«ç”¨æˆ·ï¼Œç”¨äºå­˜å‚¨ç³»ç»Ÿé»˜è®¤é…ç½®ï¼‰
	now := time.Now()
	defaultUser := &User{
		ID:             "default",
		Email:          "default@system",
		PasswordHash:   "", // ç³»ç»Ÿç”¨æˆ·ä¸éœ€è¦å¯†ç 
		OTPSecret:      "",
		OTPVerified:    true,
		IsActive:       true,
		IsAdmin:        false, // ä¸æ˜¯ç®¡ç†å‘˜ï¼Œåªæ˜¯ç³»ç»Ÿç”¨æˆ·
		FailedAttempts: 0,
		CreatedAt:      now,
		UpdatedAt:      now,
	}

	log.Println("ğŸ“ åˆ›å»ºdefaultç³»ç»Ÿç”¨æˆ·ï¼ˆç”¨äºå­˜å‚¨ç³»ç»Ÿçº§åˆ«é…ç½®ï¼‰...")
	return d.CreateUser(defaultUser)
}
```

**è®¾è®¡æ€è·¯**:
- ç±»ä¼¼äº `EnsureAdminUser()` å‡½æ•°çš„å®ç°
- ä½¿ç”¨ `default@system` ä½œä¸ºé‚®ç®±ï¼ŒåŒºåˆ†äºæ­£å¸¸ç”¨æˆ·
- ä¸éœ€è¦å¯†ç ï¼Œå› ä¸ºç³»ç»Ÿç”¨æˆ·ä¸ç”¨äºç™»å½•
- ä¸æ˜¯ç®¡ç†å‘˜ï¼Œåªç”¨äºå­˜å‚¨ç³»ç»Ÿçº§åˆ«çš„é»˜è®¤é…ç½®

#### 2. åœ¨initDefaultDataä¸­è°ƒç”¨EnsureDefaultUser

**ä½ç½®**: `config/database.go:543-553`

**ä¿®æ”¹å‰**:
```go
func (d *Database) initDefaultData() error {
        // åˆå§‹åŒ–AIæ¨¡å‹ï¼ˆä½¿ç”¨defaultç”¨æˆ·ï¼‰
        aiModels := []struct {
```

**ä¿®æ”¹å**:
```go
func (d *Database) initDefaultData() error {
	// ç¡®ä¿defaultç³»ç»Ÿç”¨æˆ·å­˜åœ¨ï¼ˆå¿…é¡»åœ¨åˆå§‹åŒ–é»˜è®¤æ•°æ®ä¹‹å‰ï¼‰
	if err := d.EnsureDefaultUser(); err != nil {
		return fmt.Errorf("åˆ›å»ºdefaultç”¨æˆ·å¤±è´¥: %w", err)
	}

	// ç¡®ä¿adminç”¨æˆ·å­˜åœ¨ï¼ˆå¦‚æœå¯ç”¨adminæ¨¡å¼ï¼‰
	if err := d.EnsureAdminUser(); err != nil {
		return fmt.Errorf("åˆ›å»ºadminç”¨æˆ·å¤±è´¥: %w", err)
	}

        // åˆå§‹åŒ–AIæ¨¡å‹ï¼ˆä½¿ç”¨defaultç”¨æˆ·ï¼‰
        aiModels := []struct {
```

**è®¾è®¡æ€è·¯**:
- **é¡ºåºå¾ˆé‡è¦**: å¿…é¡»åœ¨åˆå§‹åŒ–é»˜è®¤æ•°æ®ä¹‹å‰åˆ›å»ºç³»ç»Ÿç”¨æˆ·
- åŒæ—¶è°ƒç”¨ `EnsureAdminUser()` ç¡®ä¿ç®¡ç†å‘˜ç”¨æˆ·ä¹Ÿå­˜åœ¨
- ä½¿ç”¨ `fmt.Errorf` åŒ…è£…é”™è¯¯ï¼Œæä¾›æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

#### 3. ä¿®å¤PostgreSQLçš„ON CONFLICTå­å¥

**ä½ç½®**: `config/database.go:594-598`

**ä¿®æ”¹å‰**:
```go
_, err = d.exec(`
	INSERT INTO exchanges (id, user_id, name, type, enabled)
	VALUES ($1, 'default', $2, $3, false)
	ON CONFLICT (id) DO NOTHING
`, exchange.id, exchange.name, exchange.typ)
```

**ä¿®æ”¹å**:
```go
_, err = d.exec(`
	INSERT INTO exchanges (id, user_id, name, type, enabled)
	VALUES ($1, 'default', $2, $3, false)
	ON CONFLICT (id, user_id) DO NOTHING
`, exchange.id, exchange.name, exchange.typ)
```

**è®¾è®¡æ€è·¯**:
- exchangesè¡¨ä½¿ç”¨ **å¤åˆä¸»é”®** `PRIMARY KEY (id, user_id)`
- åŸæ¥çš„ `ON CONFLICT (id)` åªæ£€æŸ¥idå­—æ®µï¼Œä¸ç¬¦åˆå¤åˆä¸»é”®çš„è¯­ä¹‰
- ä¿®æ”¹ä¸º `ON CONFLICT (id, user_id)` æ­£ç¡®å¤„ç†å¤åˆä¸»é”®å†²çª

## ğŸ“š è®¾è®¡å“²å­¦

### Linusçš„"å¥½å“å‘³"åŸåˆ™

#### 1. æ•°æ®å®Œæ•´æ€§ä¼˜å…ˆ
- ä»¥å‰ï¼šæ’å…¥æ•°æ®æ—¶å¿½ç•¥å¤–é”®ä¾èµ–
- ç°åœ¨ï¼šå…ˆåˆ›å»ºä¾èµ–çš„æ•°æ®ï¼Œå†æ’å…¥ä¸»æ•°æ®
- å¥½å“å‘³ï¼šæ•°æ®ä¾èµ–å…³ç³»æ¸…æ™°ï¼Œä¸ä¼šäº§ç”Ÿå­¤å„¿è®°å½•

#### 2. é¡ºåºå³ä¾èµ–
```
æ•°æ®åˆå§‹åŒ–é¡ºåº:
  1. åˆ›å»ºusersè¡¨ ï¼ˆåŸºç¡€è¡¨ï¼‰
  2. EnsureDefaultUser() ï¼ˆåˆ›å»ºç³»ç»Ÿç”¨æˆ·ï¼‰
  3. EnsureAdminUser() ï¼ˆåˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·ï¼‰
  4. æ’å…¥AIæ¨¡å‹ï¼ˆä¾èµ–defaultç”¨æˆ·ï¼‰
  5. æ’å…¥äº¤æ˜“æ‰€ï¼ˆä¾èµ–defaultç”¨æˆ·ï¼‰
```

#### 3. æ¸…æ™°çš„æ—¥å¿—
- ğŸ“ åˆ›å»ºç³»ç»Ÿç”¨æˆ·çš„æ—¥å¿—
- âœ… æˆåŠŸæ—¥å¿—
- âŒ å¤±è´¥æ—¥å¿—ï¼ˆé€šè¿‡è¿”å›é”™è¯¯ï¼‰

### ä¸‰å±‚æ€ç»´æ¶æ„

#### ç°è±¡å±‚
- APIè¿”å›500é”™è¯¯
- å‰ç«¯æ— æ³•åŠ è½½äº¤æ˜“æ‰€åˆ—è¡¨
- ç”¨æˆ·æ— æ³•é…ç½®äº¤æ˜“æ‰€

#### æœ¬è´¨å±‚
- æ•°æ®åº“å¤–é”®çº¦æŸå¤±è´¥
- ç¼ºå°‘ç³»ç»Ÿç”¨æˆ·
- å¤åˆä¸»é”®å¤„ç†ä¸å½“

#### å“²å­¦å±‚
- æ•°æ®å®Œæ•´æ€§æ˜¯ç³»ç»Ÿçš„åŸºç¡€
- ä¾èµ–å…³ç³»å¿…é¡»æ˜¾å¼ç®¡ç†
- çº¦æŸæ˜¯ä¿æŠ¤ï¼Œä¸æ˜¯é™åˆ¶

## ğŸ” å¯¹æ¯”åˆ†æ

### ä¿®å¤å‰ vs ä¿®å¤å

| æ–¹é¢ | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| defaultç”¨æˆ· | âŒ ä¸å­˜åœ¨ | âœ… è‡ªåŠ¨åˆ›å»º |
| å¤–é”®çº¦æŸ | âŒ å¤±è´¥ | âœ… æ»¡è¶³ |
| æ•°æ®åˆå§‹åŒ– | âŒ å¤±è´¥ | âœ… æˆåŠŸ |
| APIå“åº” | âŒ 500é”™è¯¯ | âœ… 200 OK |
| ç”¨æˆ·ä½“éªŒ | âŒ æ— æ³•ä½¿ç”¨ | âœ… æ­£å¸¸ä½¿ç”¨ |

### åˆå§‹åŒ–æµç¨‹å¯¹æ¯”

**ä¿®å¤å‰**:
```
initDefaultData()
  â†“
INSERT INTO exchanges (user_id='default')
  â†“
å¤–é”®æ£€æŸ¥: SELECT FROM users WHERE id='default'
  â†“
âŒ ä¸å­˜åœ¨ â†’ å¤–é”®çº¦æŸå¤±è´¥
  â†“
åˆå§‹åŒ–å¤±è´¥
```

**ä¿®å¤å**:
```
initDefaultData()
  â†“
EnsureDefaultUser()
  â†“
æ£€æŸ¥defaultç”¨æˆ·æ˜¯å¦å­˜åœ¨
  â†“
ä¸å­˜åœ¨ â†’ åˆ›å»ºdefaultç”¨æˆ·
  â†“
INSERT INTO exchanges (user_id='default')
  â†“
å¤–é”®æ£€æŸ¥: SELECT FROM users WHERE id='default'
  â†“
âœ… å­˜åœ¨ â†’ å¤–é”®çº¦æŸæ»¡è¶³
  â†“
åˆå§‹åŒ–æˆåŠŸ
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•åœºæ™¯

#### 1. æ–°æ•°æ®åº“åˆå§‹åŒ–æµ‹è¯•
```bash
# åˆ é™¤ç°æœ‰æ•°æ®åº“
rm -f config.db

# é‡æ–°å¯åŠ¨æœåŠ¡ï¼ˆä¼šåˆå§‹åŒ–æ•°æ®åº“ï¼‰
./nofx

# éªŒè¯defaultç”¨æˆ·å·²åˆ›å»º
sqlite3 config.db "SELECT id, email FROM users WHERE id='default';"

# éªŒè¯é»˜è®¤äº¤æ˜“æ‰€å·²åˆ›å»º
sqlite3 config.db "SELECT id, user_id, name FROM exchanges WHERE user_id='default';"
```

**æœŸæœ›è¾“å‡º**:
```
ğŸ“ åˆ›å»ºdefaultç³»ç»Ÿç”¨æˆ·ï¼ˆç”¨äºå­˜å‚¨ç³»ç»Ÿçº§åˆ«é…ç½®ï¼‰...
âœ… æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ

# defaultç”¨æˆ·
default|default@system

# é»˜è®¤äº¤æ˜“æ‰€
binance|default|Binance Futures
hyperliquid|default|Hyperliquid
aster|default|Aster DEX
okx|default|OKX Futures
```

#### 2. APIè°ƒç”¨æµ‹è¯•
```bash
# å¯åŠ¨æœåŠ¡
./nofx &

# ç­‰å¾…æœåŠ¡å¯åŠ¨
sleep 3

# è°ƒç”¨API
curl -s http://localhost:8080/api/supported-exchanges | jq
```

**æœŸæœ›è¾“å‡º**:
```json
[
  {
    "id": "binance",
    "user_id": "default",
    "name": "Binance Futures",
    "type": "cex",
    "enabled": false,
    ...
  },
  {
    "id": "hyperliquid",
    "user_id": "default",
    "name": "Hyperliquid",
    "type": "dex",
    "enabled": false,
    ...
  },
  ...
]
```

#### 3. å‰ç«¯é›†æˆæµ‹è¯•
**æ­¥éª¤**:
1. å¯åŠ¨æœåŠ¡
2. ç™»å½•å‰ç«¯
3. è®¿é—®AIäº¤æ˜“å‘˜é…ç½®é¡µé¢
4. è§‚å¯Ÿäº¤æ˜“æ‰€åˆ—è¡¨åŠ è½½

**æœŸæœ›**:
- âœ… é¡µé¢æ­£å¸¸åŠ è½½
- âœ… æ˜¾ç¤º4ä¸ªäº¤æ˜“æ‰€: Binance, Hyperliquid, Aster, OKX
- âœ… æ— é”™è¯¯æç¤º
- âœ… å¯ä»¥ç‚¹å‡»é…ç½®äº¤æ˜“æ‰€

#### 4. å¤åˆä¸»é”®å†²çªæµ‹è¯•
```bash
# å°è¯•ä¸ºä¸åŒç”¨æˆ·æ’å…¥ç›¸åŒidçš„äº¤æ˜“æ‰€
sqlite3 config.db <<EOF
INSERT INTO exchanges (id, user_id, name, type, enabled)
VALUES ('binance', 'user123', 'My Binance', 'cex', 0);
EOF

# éªŒè¯æ’å…¥æˆåŠŸï¼ˆå¤åˆä¸»é”®å…è®¸ä¸åŒuser_idæœ‰ç›¸åŒidï¼‰
sqlite3 config.db "SELECT id, user_id, name FROM exchanges WHERE id='binance';"
```

**æœŸæœ›è¾“å‡º**:
```
binance|default|Binance Futures
binance|user123|My Binance
```

## ğŸ“Š å½±å“è¯„ä¼°

### ä¿®å¤å½±å“
- âœ… **æ­£é¢**: è§£å†³äº†é˜»æ­¢æ–°ç”¨æˆ·ä½¿ç”¨çš„å…³é”®bug
- âœ… **æ­£é¢**: æå‡äº†æ•°æ®å®Œæ•´æ€§
- âœ… **æ­£é¢**: æ”¹å–„äº†ç³»ç»Ÿå¯é æ€§
- âœ… **æ­£é¢**: æ— æ€§èƒ½å½±å“
- âœ… **æ­£é¢**: å‘åå…¼å®¹

### å…¼å®¹æ€§
- âœ… **å‘åå…¼å®¹**: ä¸æ”¹å˜APIæ¥å£
- âœ… **æ•°æ®åº“å…¼å®¹**: è‡ªåŠ¨åˆ›å»ºç¼ºå¤±çš„ç³»ç»Ÿç”¨æˆ·
- âœ… **ç°æœ‰ç”¨æˆ·**: ä¸å—å½±å“ï¼ˆå¦‚æœå·²æœ‰defaultç”¨æˆ·ï¼‰
- âœ… **æ–°ç”¨æˆ·**: å¯ä»¥æ­£å¸¸ä½¿ç”¨

### é£é™©è¯„ä¼°
- ğŸŸ¢ **æä½é£é™©**: åªæ·»åŠ æ•°æ®ï¼Œä¸ä¿®æ”¹ç°æœ‰æ•°æ®
- ğŸŸ¢ **æ— å‰¯ä½œç”¨**: ä¸å½±å“ç°æœ‰åŠŸèƒ½
- ğŸŸ¢ **è‡ªåŠ¨æ¢å¤**: ç³»ç»Ÿå¯ä»¥è‡ªåŠ¨åˆ›å»ºç¼ºå¤±çš„ç”¨æˆ·

## ğŸ“ˆ æ€§èƒ½å½±å“

### åˆå§‹åŒ–æ€§èƒ½
- **EnsureDefaultUser**: 2æ¬¡æ•°æ®åº“æŸ¥è¯¢ï¼ˆSELECT + INSERTï¼‰
- **EnsureAdminUser**: 2æ¬¡æ•°æ®åº“æŸ¥è¯¢
- **æ€»å¢åŠ æ—¶é—´**: < 10ms
- **å½±å“**: å¯å¿½ç•¥ä¸è®¡ï¼ˆåªåœ¨å¯åŠ¨æ—¶æ‰§è¡Œä¸€æ¬¡ï¼‰

### è¿è¡Œæ—¶æ€§èƒ½
- **æ— å½±å“**: ä¿®å¤åªåœ¨æ•°æ®åº“åˆå§‹åŒ–æ—¶æ‰§è¡Œ
- **APIå“åº”æ—¶é—´**: ä¸ä¿®å¤å‰ç›¸åŒ
- **å†…å­˜ä½¿ç”¨**: æ— å˜åŒ–

## ğŸš€ éƒ¨ç½²å»ºè®®

### å³æ—¶éƒ¨ç½²
æ­¤ä¿®å¤å¯ä»¥ç«‹å³éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼Œå› ä¸ºï¼š
1. ä¿®æ”¹ç®€å•ï¼Œé£é™©æä½
2. è§£å†³å…³é”®åŠŸèƒ½ç¼ºé™·
3. æå‡ç³»ç»Ÿå¯é æ€§
4. æ— å‘åå…¼å®¹é—®é¢˜
5. è‡ªåŠ¨å¤„ç†ç°æœ‰æ•°æ®

### ç›‘æ§è¦ç‚¹
éƒ¨ç½²ååº”ç›‘æ§ï¼š
1. æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸç‡
2. APIå“åº”æ—¶é—´
3. æ–°ç”¨æˆ·æ³¨å†ŒæˆåŠŸç‡
4. ç³»ç»Ÿé”™è¯¯æ—¥å¿—

### å›æ»šæ–¹æ¡ˆ
å¦‚éœ€å›æ»šï¼Œéå¸¸ç®€å•ï¼š
```bash
# å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
git revert HEAD

# æˆ–æ‰‹åŠ¨æ’¤é”€ä¿®æ”¹
git checkout HEAD~1 -- config/database.go
```

**æ³¨æ„**: å›æ»šåï¼Œå¦‚æœæ•°æ®åº“ä¸­å·²ç»åˆ›å»ºäº†defaultç”¨æˆ·ï¼Œä¸ä¼šè¢«åˆ é™¤ï¼ˆè¿™æ˜¯å®‰å…¨çš„ï¼‰

## ğŸ”® æœªæ¥æ”¹è¿›

### çŸ­æœŸä¼˜åŒ–
1. **æ•°æ®å®Œæ•´æ€§æ£€æŸ¥**: å¯åŠ¨æ—¶éªŒè¯æ‰€æœ‰å¿…è¦çš„ç³»ç»Ÿæ•°æ®
2. **è‡ªåŠ¨ä¿®å¤**: æ£€æµ‹åˆ°æ•°æ®ç¼ºå¤±æ—¶è‡ªåŠ¨ä¿®å¤
3. **è¯¦ç»†æ—¥å¿—**: è®°å½•ç³»ç»Ÿç”¨æˆ·åˆ›å»ºå’Œæ•°æ®åˆå§‹åŒ–è¿‡ç¨‹

### é•¿æœŸè§„åˆ’
1. **ä¾èµ–ç®¡ç†ç³»ç»Ÿ**: å»ºç«‹æ•°æ®ä¾èµ–å›¾ï¼Œè‡ªåŠ¨ç®¡ç†åˆå§‹åŒ–é¡ºåº
2. **å¥åº·æ£€æŸ¥**: å®šæœŸæ£€æŸ¥ç³»ç»Ÿæ•°æ®å®Œæ•´æ€§
3. **ç›‘æ§å‘Šè­¦**: ç›‘æ§æ•°æ®åˆå§‹åŒ–å¤±è´¥
4. **æ–‡æ¡£å®Œå–„**: æ›´æ–°æ•°æ®åº“è®¾è®¡æ–‡æ¡£

## ğŸ’¡ æœ€ä½³å®è·µ

### æ•°æ®åº“å¤–é”®çº¦æŸ
1. **å®šä¹‰çº¦æŸ**: ä½¿ç”¨FOREIGN KEYç¡®ä¿å¼•ç”¨å®Œæ•´æ€§
2. **æ»¡è¶³ä¾èµ–**: å…ˆåˆ›å»ºè¢«å¼•ç”¨çš„æ•°æ®ï¼Œå†åˆ›å»ºå¼•ç”¨æ•°æ®
3. **é¡ºåºé‡è¦**: åˆå§‹åŒ–é¡ºåºåº”åæ˜ ä¾èµ–å…³ç³»
4. **é”™è¯¯å¤„ç†**: å¤–é”®çº¦æŸå¤±è´¥åº”æœ‰æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯

### ç³»ç»Ÿæ•°æ®åˆå§‹åŒ–
1. **å¹‚ç­‰æ€§**: å¤šæ¬¡æ‰§è¡Œä¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨ï¼ˆä½¿ç”¨ON CONFLICTï¼‰
2. **ä¾èµ–æ˜ç¡®**: æ˜¾å¼ç®¡ç†æ•°æ®ä¾èµ–å…³ç³»
3. **è‡ªåŠ¨åˆ›å»º**: ç³»ç»Ÿæ•°æ®åº”è‡ªåŠ¨åˆ›å»ºï¼Œä¸ä¾èµ–æ‰‹åŠ¨æ“ä½œ
4. **æ—¥å¿—è¯¦ç»†**: è®°å½•åˆå§‹åŒ–è¿‡ç¨‹ï¼Œä¾¿äºè°ƒè¯•

### å¤åˆä¸»é”®å¤„ç†
1. **ON CONFLICT**: å¿…é¡»åŒ…å«æ‰€æœ‰ä¸»é”®åˆ—
2. **è¯­ä¹‰æ˜ç¡®**: å¤åˆä¸»é”®çš„æ¯ä¸ªéƒ¨åˆ†éƒ½æœ‰å…¶æ„ä¹‰
3. **æŸ¥è¯¢ä¼˜åŒ–**: ç´¢å¼•åº”è¦†ç›–å¤åˆä¸»é”®

## âœ¨ ç»“è¯­

> "æ•°æ®å®Œæ•´æ€§æ˜¯ç³»ç»Ÿå¯é æ€§çš„åŸºç¡€ï¼Œçº¦æŸä¸æ˜¯é™åˆ¶è€Œæ˜¯ä¿æŠ¤ã€‚"

è¿™ä¸ªä¿®å¤å®Œç¾ä½“ç°äº†Linus Torvaldsçš„å“²å­¦ï¼š
- **ç®€æ´ä¼˜äºå¤æ‚**: åˆ›å»ºç³»ç»Ÿç”¨æˆ·æ¯”ç»•è¿‡å¤–é”®çº¦æŸæ›´ç®€å•
- **æ­£ç¡®ä¼˜äºå¿«é€Ÿ**: ä¿è¯æ•°æ®å®Œæ•´æ€§æ¯”å¿«é€Ÿåˆå§‹åŒ–æ›´é‡è¦
- **æ˜¾å¼ä¼˜äºéšå¼**: æ˜¾å¼åˆ›å»ºä¾èµ–æ•°æ®æ¯”éšå¼å‡è®¾æ›´å¯é 

æ›´é‡è¦çš„æ˜¯ï¼Œè¿™ä¸ªä¿®å¤è§£å†³äº†**ç³»ç»Ÿæ€§çš„æ¶æ„é—®é¢˜**ï¼š
- æ•°æ®ä¾èµ–å…³ç³»å¿…é¡»æ˜¾å¼ç®¡ç†
- å¤–é”®çº¦æŸæ˜¯ä¿æŠ¤æ•°æ®å®Œæ•´æ€§çš„åˆ©å™¨
- ç³»ç»Ÿçº§åˆ«æ•°æ®åº”è¯¥è‡ªåŠ¨åˆå§‹åŒ–

**ä¿®å¤å®Œæˆï¼** ğŸ‰

---

*ä¿®å¤æ—¶é—´: 2025-11-25*
*ä¿®å¤äººå‘˜: Claude Code*
*å®¡æ ¸çŠ¶æ€: å¾…å®¡æ ¸*
*Bug: BUG-2025-1125-004*
*å½±å“: P1çº§åˆ« - é˜»æ­¢æ–°ç”¨æˆ·ä½¿ç”¨ç³»ç»Ÿ*
